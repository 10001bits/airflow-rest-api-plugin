{% extends "airflow/master.html" %}

{% block title %}Airflow - REST API{% endblock %}

{% block head_css %}
{{ super() }}

{% endblock %}

{% block body %}

<style type="text/css">
    #dags-table table { border-collapse: collapse; }
    #dags-table td + td, #dags-table th + th { border-left: 1px solid; }
    #dags-table tr + tr { border-top: 1px solid; }
    th, td { padding: 4px; }
</style>

<!--todo: Add a new column to the tables to document what the variables are for and if they're required-->
<!--todo: add what version of airflow each command is available in-->


<h1>Airflow REST API </h1>

<h2>Documentation</h2>
<ul>
    <li><a href="https://airflow.incubator.apache.org/cli.html">Official Airflow CLI Documentation</a></li>
    <li><a href="https://github.com/teamclairvoyant/airflow-rest-api-plugin">REST API Plugin Documentation</a></li>
</ul>


<h2>DAGs:</h2>
<table id="dags-table">
    <tr>
        <th>DAG ID</th><th>Is Active</th>
    </tr>
    {% for dag in dags %}
    <tr>
        <td>{{dag.dag_id}}</td><td>{{dag.is_active}}</td>
    </tr>
    {% endfor %}
</table>

<h2>APIs</h2>
{% for api_object in apis %}
<div>
    <h3>{{api_object.name}}</h3>
    <h5>{{api_object.description}}</h5>
    <h5>{{api_object.http_method}} {{airflow_webserver_base_url}}{{rest_api_endpoint}}?api={{api_object.name}}{% if api_object.http_method != 'POST' %}{% for parameter in api_object.parameters %}&{{parameter.name}}{% if parameter.form_type != 'checkbox' %}=value{% endif %}{% endfor %}{% endif %}</h5>

    {% if api_object.form_enctype %}
    <h5>enctype=api_object.form_enctype</h5>
    {% endif %}

    {% if api_object.post_body_description %}
    <h6>{api_object.post_body_description}</h6>
    {% endif %}

    <h6>Available in Airflow Version: <b>{{api_object.airflow_version}} or greater</b></h6>
    <div>
        <form method="{{api_object.http_method}}"
              target="_blank"
              action="{{airflow_webserver_base_url}}{{rest_api_endpoint}}"
              {{ 'enctype="' + api_object.form_enctype + '"' if api_object.form_enctype }}
        >
            <table>
                <input type="hidden" name="api" value="{{api_object.name}}" />

                <tr>
                    <th>Argument Name</th>
                    <th>Input</th>
                    <th>Required</th>
                    <th>Description</th>
                </tr>

                {% for parameter in api_object.parameters %}
                <tr>
                    <td>{{parameter.name}}:</td>
                    <td><input type="{{parameter.form_type}}" name="{{parameter.name}}"/></td>
                    <td>{{parameter.required}}</td>
                    <td>{{parameter.description}}</td>
                </tr>
                {% endfor %}
                <tr>
                    <td colspan="2"><input type="submit" value="Execute"/></td>
                </tr>
            </table>
        </form>
    </div>
</div>
<br/>

{% endfor %}

<br/>

{% endblock %}

{% block tail %}
{{ super() }}

{% endblock %}
